generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String        @id @default(uuid())
  title         String?
  firstName     String
  lastName      String
  email         String        @unique
  password      String?
  phone         String?
  avatar        String?
  jobTitle      String?
  department    String?
  lastLogin     DateTime?
  invitedBy     String?
  invitedAt     DateTime?
  joinedAt      DateTime?
  status        UserStatus    @default(Pending)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  roles         UserRole[]
  createdCompanies Company[]  @relation("CreatedBy")
  userCompanies UserCompany[]
}

model Permission {
  id          String           @id @default(uuid())
  name        String
  code        String           @unique
  description String
  module      String
  accessLevel AccessLevel
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  roles       RolePermission[]

  @@index([module])
  @@index([accessLevel])
}

model Role {
  id          String           @id @default(uuid())
  name        String           @unique
  description String
  scope       RoleScope
  status      RoleStatus       @default(Active)
  isCustom    Boolean          @default(true)
  isSystem    Boolean          @default(false)
  metadata    Json?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  permissions RolePermission[]
  users       UserRole[]

  @@index([scope])
  @@index([status])
}

model RolePermission {
  roleId       String
  permissionId String
  assignedAt   DateTime   @default(now())
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@id([roleId, permissionId])
  @@index([roleId])
  @@index([permissionId])
}

model UserRole {
  userId     String
  roleId     String
  assignedAt DateTime @default(now())
  role       Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, roleId])
  @@index([userId])
  @@index([roleId])
}

model UserCompany {
  userId     String
  companyId  String
  role       String
  assignedAt DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  company    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@id([userId, companyId])
  @@index([userId])
  @@index([companyId])
}

model Director {
  id                 String         @id @default(cuid())
  title              String
  firstName          String
  lastName           String
  dateOfBirth        DateTime
  nationality        String
  address            String
  appointmentDate    DateTime
  resignationDate    DateTime?
  directorType       String
  occupation         String
  otherDirectorships String
  shareholding       String
  status             DirectorStatus
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  companyId          String
  company            Company        @relation(fields: [companyId], references: [id])
}

model Shareholder {
  id                 String   @id @default(cuid())
  title              String
  firstName          String
  lastName           String
  dateOfBirth        DateTime
  nationality        String
  address            String
  email              String
  phone              String
  ordinaryShares     Int
  preferentialShares Int
  dateAcquired       DateTime
  status             Status
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  companyId          String
  company            Company  @relation(fields: [companyId], references: [id])
}

model Share {
  id             String    @id @default(cuid())
  class          String
  type           ShareType
  nominalValue   Float
  currency       String
  votingRights   Boolean
  dividendRights Boolean
  transferable   Boolean
  totalIssued    Int
  status         Status
  description    String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  companyId      String
  company        Company   @relation(fields: [companyId], references: [id])
}

model BeneficialOwner {
  id                  String   @id @default(cuid())
  title               String
  firstName           String
  lastName            String
  dateOfBirth         DateTime
  nationality         String
  address             String
  email               String
  phone               String
  natureOfControl     String[]
  ownershipPercentage Float
  registrationDate    DateTime
  status              Status
  description         String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  companyId           String
  company             Company  @relation(fields: [companyId], references: [id])
}

model Charge {
  id               String    @id @default(cuid())
  chargeId         String    @unique
  chargeType       String
  dateCreated      DateTime
  amount           Float
  currency         String
  chargor          String
  chargee          String
  description      String
  propertyCharged  String
  registrationDate DateTime
  status           String
  satisfactionDate DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  companyId        String
  company          Company   @relation(fields: [companyId], references: [id])
}

model Allotment {
  id                String        @id @default(cuid())
  allotmentId       String        @unique
  allotmentDate     DateTime
  shareClass        String
  numberOfShares    Int
  pricePerShare     Float
  currency          String
  allottee          String
  paymentStatus     PaymentStatus
  amountPaid        Float?
  paymentDate       DateTime?
  certificateNumber String?
  status            Status
  notes             String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  companyId         String
  company           Company       @relation(fields: [companyId], references: [id])
}

model Resolution {
  id            String            @id @default(cuid())
  title         String
  type          ResolutionType?
  description   String
  outcome       ResolutionOutcome
  proposedBy    String?
  secondedBy    String?
  meetingId     String?
  boardMinuteId String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  boardMinute   BoardMinute?      @relation(fields: [boardMinuteId], references: [id])
  meeting       Meeting?          @relation(fields: [meetingId], references: [id])
}

model Meeting {
  id             String         @id @default(cuid())
  meetingId      String         @unique
  meetingDate    DateTime
  meetingType    MeetingType
  venue          String
  startTime      DateTime
  endTime        DateTime
  chairperson    String
  attendees      String[]
  agenda         String
  quorumRequired Int
  quorumPresent  Int
  quorumAchieved Boolean
  minutes        String
  status         DocumentStatus
  attachments    String[]
  notes          String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  companyId      String
  company        Company        @relation(fields: [companyId], references: [id])
  resolutions    Resolution[]
}

model ActionItem {
  id           String           @id @default(cuid())
  task         String
  assignee     String
  dueDate      DateTime
  status       ActionItemStatus
  discussionId String
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  discussion   Discussion       @relation(fields: [discussionId], references: [id])
}

model Discussion {
  id            String       @id @default(cuid())
  topic         String
  details       String
  decisions     String[]
  boardMinuteId String
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  actionItems   ActionItem[]
  boardMinute   BoardMinute  @relation(fields: [boardMinuteId], references: [id])
}

model BoardMinute {
  id          String         @id @default(cuid())
  minuteId    String         @unique
  meetingDate DateTime
  startTime   DateTime
  endTime     DateTime
  venue       String
  chairperson String
  attendees   String[]
  agenda      String
  minutes     String
  status      DocumentStatus
  attachments String[]
  notes       String?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  companyId   String
  company     Company        @relation(fields: [companyId], references: [id])
  discussions Discussion[]
  resolutions Resolution[]
}

model Activity {
  id          String       @id @default(cuid())
  type        ActivityType
  entityType  String?
  entityId    String?
  description String
  user        String
  time        DateTime
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  companyId   String
  company     Company      @relation(fields: [companyId], references: [id])

  @@index([entityType, entityId])
  @@index([companyId])
  @@index([time])
}

model PrimaryContact {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String
  role      String
  companyId String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  company   Company  @relation(fields: [companyId], references: [id])
}

model Company {
  id               String            @id @default(cuid())
  name             String
  status           Status            @default(Active)
  isPrimary        Boolean           @default(false)
  isMyOrg          Boolean           @default(false)
  tags             String[]          @default([])
  logo             String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  createdById      String
  createdBy        User              @relation("CreatedBy", fields: [createdById], references: [id])
  userCompanies    UserCompany[]
  activities       Activity[]
  allotments       Allotment[]
  beneficialOwners BeneficialOwner[]
  boardMinutes     BoardMinute[]
  charges          Charge[]
  directors        Director[]
  meetings         Meeting[]
  primaryContact   PrimaryContact?
  shares           Share[]
  shareholders     Shareholder[]
}

enum Status {
  Active
  Inactive
  Archived
}

enum DocumentStatus {
  Draft
  Final
  Signed
}

enum DirectorStatus {
  Active
  Resigned
}

enum ShareType {
  Ordinary
  Preferential
  Deferred
}

enum PaymentStatus {
  Paid
  Unpaid
  Partially_Paid
}

enum ResolutionType {
  Ordinary
  Special
}

enum ResolutionOutcome {
  Passed
  Rejected
  Pending
  Deferred
}

enum MeetingType {
  AGM
  EGM
  Class_Meeting
}

enum ActionItemStatus {
  Pending
  In_Progress
  Completed
}

enum ActivityType {
  appointment
  resignation
  update
  removal
  added
  updated
  removed
  status_changed
}

enum RoleScope {
  Global
  Company
  Team
}

enum RoleStatus {
  Active
  Inactive
  Deprecated
}

enum AccessLevel {
  None
  Read
  Write
  Admin
}

enum UserStatus {
  Active
  Inactive
  Pending
  Suspended
}
